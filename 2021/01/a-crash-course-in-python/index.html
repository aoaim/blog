<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Python 速成 - Miaonote</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Python 速成" />
<meta property="og:description" content="本篇摘抄與《數據科學入門（第二版）》第二章。在圖靈社區閑逛時偶然發現這一章，如獲至寶。這篇不是 Python 的完整教程，但包含了 Python 的基礎操作和基本技能，如同一個速查表。好好學習！" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/2021/01/a-crash-course-in-python/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-01-20T00:00:00&#43;00:00" />
<meta property="article:modified_time" content="2021-01-20T00:00:00&#43;00:00" />


		<meta itemprop="name" content="Python 速成">
<meta itemprop="description" content="本篇摘抄與《數據科學入門（第二版）》第二章。在圖靈社區閑逛時偶然發現這一章，如獲至寶。這篇不是 Python 的完整教程，但包含了 Python 的基礎操作和基本技能，如同一個速查表。好好學習！"><meta itemprop="datePublished" content="2021-01-20T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2021-01-20T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="2765">
<meta itemprop="keywords" content="Python," />
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	<link rel="stylesheet" href="/css/custom.css">

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo logo--mixed">
		<a class="logo__link" href="/" title="Miaonote" rel="home">
			<div class="logo__item logo__imagebox">
					<img class="logo__img" src="/img/cat.png">
				</div><div class="logo__item logo__text">
					<div class="logo__title">Miaonote</div>
					<div class="logo__tagline">你的夢想是世界上最偉大的事</div>
				</div>
		</a>
	</div>
		
<nav class="menu">
	<button class="menu__btn" aria-haspopup="true" aria-expanded="false" tabindex="0">
		<span class="menu__btn-title" tabindex="-1">Menu</span>
	</button>
	<ul class="menu__list">
		<li class="menu__item">
			<a class="menu__link" href="/about/">
				
				<span class="menu__text">About</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/links/">
				
				<span class="menu__text">Links</span>
				
			</a>
		</li>
	</ul>
</nav>

	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Python 速成</h1>
			<div class="post__meta meta">
<div class="meta__item-datetime meta__item">
	<svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class="meta__text" datetime="2021-01-20T00:00:00Z">01-20-2021</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2l1 2h8v11h-16v-13z"/></svg><span class="meta__text"><a class="meta__link" href="/categories/%E8%88%88%E8%B6%A3%E5%AD%B8%E7%BF%92/" rel="category">興趣學習</a>
	</span>
</div></div>
		</header>
<div class="post__toc toc">
	<div class="toc__title">Page content</div>
	<div class="toc__menu">
		<nav id="TableOfContents">
  <ul>
    <li><a href="#21python-之禅">2.1　Python 之禅</a></li>
    <li><a href="#22获取-python">2.2　获取 Python</a></li>
    <li><a href="#23虚拟环境">2.3　虚拟环境</a></li>
    <li><a href="#24空白格式">2.4　空白格式</a></li>
    <li><a href="#25模块">2.5　模块</a></li>
    <li><a href="#26函数">2.6　函数</a></li>
    <li><a href="#27字符串">2.7　字符串</a></li>
    <li><a href="#28异常">2.8　异常</a></li>
    <li><a href="#29列表">2.9　列表</a></li>
    <li><a href="#210元组">2.10　元组</a></li>
    <li><a href="#211字典">2.11　字典</a>
      <ul>
        <li><a href="#defaultdict"><code>defaultdict</code></a></li>
      </ul>
    </li>
    <li><a href="#212计数器">2.12　计数器</a></li>
    <li><a href="#213集">2.13　集</a></li>
    <li><a href="#214控制流">2.14　控制流</a></li>
    <li><a href="#215真和假">2.15　真和假</a></li>
    <li><a href="#216排序">2.16　排序</a></li>
    <li><a href="#217列表解析">2.17　列表解析</a></li>
    <li><a href="#218自动化测试和断言">2.18　自动化测试和断言</a></li>
    <li><a href="#219面向对象编程">2.19　面向对象编程</a></li>
    <li><a href="#220迭代器和生成器">2.20　迭代器和生成器</a></li>
    <li><a href="#221随机性">2.21　随机性</a></li>
    <li><a href="#222正则表达式">2.22　正则表达式</a></li>
    <li><a href="#223函数式编程">2.23　函数式编程</a></li>
    <li><a href="#224压缩和参数拆分">2.24　压缩和参数拆分</a></li>
    <li><a href="#225args-和-kwargs">2.25　<code>args</code> 和 <code>kwargs</code></a></li>
    <li><a href="#226类型注释">2.26　类型注释</a>
      <ul>
        <li><a href="#如何编写类型注释">如何编写类型注释</a></li>
      </ul>
    </li>
    <li><a href="#227欢迎来到-datasciencester">2.27　欢迎来到 DataSciencester</a></li>
    <li><a href="#228进一步探索">2.28　进一步探索</a></li>
  </ul>
</nav>
	</div>
</div><div class="content post__content clearfix">
			<p>本篇摘抄與<a href="https://www.ituring.com.cn/book/tupubarticle/34241">《數據科學入門（第二版）》第二章</a>。在圖靈社區閑逛時偶然發現這一章，如獲至寶。這篇不是 Python 的完整教程，但包含了 Python 的基礎操作和基本技能，如同一個速查表。好好學習！</p>
<hr>
<blockquote>
<p>难以置信，25 年以来 Python 始终广受追捧。</p>
<p>—— 迈克尔・佩林</p>
</blockquote>
<p>DataSciencester 的所有新员工都需要接受入职培训，其中最有趣的部分是 Python 的速成课程。</p>
<p>本章不是全面的 Python 教程，而是旨在突出对我们来说最重要的部分（其中一部分通常不是 Python 培训教程的重点）。如果之前从未使用过 Python，那么你可能先需要学习一点入门课程来了解它。</p>
<h2 id="21python-之禅">2.1　Python 之禅</h2>
<p>Python 对其设计原则有一些禅宗意味的描述，你可以在 python 解释器中输入 “import this” 查看。</p>
<p>其中讨论最多的一句如下所示：</p>
<blockquote>
<p>应该提供一种 —— 且最好只提供一种 —— 明显的解决方案。</p>
</blockquote>
<p>按照这种 “明显” 的方式编写的代码（对新手来说可能并不明显）通常被称为 “Python 风格”。虽然这不是一本专门介绍 Python 的书，但我们偶尔会对比用 Python 风格和非 Python 风格的方式来做相同的事情。当然，我们通常会支持用 Python 风格的方式解决问题。</p>
<p>其他几句则涉及美学：</p>
<blockquote>
<p>美优于丑，明确优于隐晦，简单优于复杂。</p>
</blockquote>
<p>这些思想将代码中体现。</p>
<h2 id="22获取-python">2.2　获取 Python</h2>
<blockquote>
<p>由于相关安装指南的内容可能会发生变化，而印刷好的纸书不能及时更新，有关如何安装 Python 的最新说明可以在本书的 GitHub 中找到。</p>
<p>如果书中的安装指南不适合你，请在下面查看。</p>
</blockquote>
<p>你可以从 Python 网站下载 Python，但如果你没安装 Python，建议安装 Anaconda 版，该版已包含了数据科学工作中所需的大多数库。</p>
<p>我编写本书第 1 版时，Python 2.7 仍是大多数数据科学家的首选版本。因此，本书的第 1 版是基于 Python 2.7 写的。</p>
<p>然而，在过去几年中，绝大多数人已开始使用 Python 3。最近的 Python 版本有许多功能，可以更容易地编写干净的代码，我们将充分利用仅在 Python 3.6 或更高版本中才有的功能优势。这意味着应该安装 Python 3.6 或更高版本。（此外，许多有用的库即将结束对 Python 2.7 的支持，这是升级版本的另一个原因。）</p>
<h2 id="23虚拟环境">2.3　虚拟环境</h2>
<p>下一章开始使用 matplotlib 库生成图表。这个库不属于 Python 的核心，因此需要自己安装。每个数据科学项目都要依赖一些外部库，有时甚至不同的项目需要不同版本的库。如果你只安装单个 Python，这些库就会发生冲突并导致各种问题。</p>
<p>标准的解决方案是使用<strong>虚拟环境</strong>（virtual environment），这些是沙盒化的 Python 环境，它们维护自己的 Python 库版本（根据设置环境的方式，还可以管理 Python 的版本）。</p>
<p>本节将解释如何设置 Anaconda 的工作环境，因此建议你安装 Anaconda Python 版。如果不使用 Anaconda，可以使用内置的 <code>venv</code> 模块或安装 <code>virtualenv</code> 模块。在这种情况下，你应该遵循其指南。</p>
<p>要创建（Anaconda）虚拟环境，只需执行以下操作：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">conda create -n dsfs python<span style="color:#f92672">=</span>3.6
</code></pre></div><p>按照提示操作，你将拥有一个名为 “dsfs” 的虚拟环境，其中包含以下说明：</p>
<p>如上所示，然后使用以下命令激活环境：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">source activate dsfs
</code></pre></div><p>现在，命令提示符中应该变为显示环境激活状态。在我的 MacBook 上，表现如下所示：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">(</span>dsfs<span style="color:#f92672">)</span> ip-10-0-0-198:~ joelg$
</code></pre></div><p>只要此环境处于活动状态，安装的任何库都将仅安装在 dsfs 环境中。在看完本书后，你应该为自己的后续项目创建环境。</p>
<p>现在你已拥有了自己的虚拟环境，首先安装 IPython，它是一个功能齐全的 Python shell：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">python -m pip install ipython
</code></pre></div><blockquote>
<p>Anaconda 带有自己的库管理器 <code>conda</code>，但也可以使用 Python 的标准包管理器 <code>pip</code>，这也是我们要用的。</p>
</blockquote>
<p>本书的其余部分将假设你已创建并激活了这样的 Python 3.6 虚拟环境（随便用什么名称都可以），后面章节中学习的内容会依赖于前面章节中安装的库。</p>
<p>一条铁律：在虚拟环境中工作，而不是使用 “base” 环境（Python 基础环境）。</p>
<h2 id="24空白格式">2.4　空白格式</h2>
<p>许多语言使用大括号来分隔代码块。Python 使用缩进：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span>]:
    <span style="color:#66d9ef">print</span>(i)
    <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span>]:
        <span style="color:#66d9ef">print</span>(j)
        <span style="color:#66d9ef">print</span>(i <span style="color:#f92672">+</span> j)
    <span style="color:#66d9ef">print</span>(i)
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;done looping&#34;</span>)
</code></pre></div><p>这使得 Python 代码非常易读，但也意味着你必须非常小心缩进格式。</p>
<blockquote>
<p>程序员经常会争论缩进是使用 Tab 还是空格。对于许多语言而言，这并不重要，但 Python 会认为 Tab 和空格是不同的缩进，如果混合使用则会使代码无法运行。编写 Python 时，应始终使用空格，而不是 Tab。（如果在编辑器中编写代码，则可以对其进行配置，使得 Tab 键只插入空格。）</p>
</blockquote>
<p>Python 会忽略方括号和圆括号内的空格，这对冗长的计算很有帮助：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">long_winded_computation <span style="color:#f92672">=</span> (<span style="color:#ae81ff">1</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">3</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">4</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">5</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">6</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">7</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">8</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">9</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">10</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">11</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">12</span> <span style="color:#f92672">+</span>
                           <span style="color:#ae81ff">13</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">14</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">15</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">16</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">17</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">18</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">19</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">20</span>)
</code></pre></div><p>并使代码更易读：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">list_of_lists <span style="color:#f92672">=</span> [[<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>], [<span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">6</span>], [<span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">9</span>]]

easier_to_read_list_of_lists <span style="color:#f92672">=</span> [[<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>],
                                [<span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">6</span>],
                                [<span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">9</span>]]
</code></pre></div><p>你也可以使用反斜杠来表示语句继续到下一行，尽管我们几乎不这么做：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">two_plus_three <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> \
                 <span style="color:#ae81ff">3</span>
</code></pre></div><p>空白格式的一个后果是，很难将代码复制并粘贴到 Python shell 中。如果尝试粘贴代码：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span>]:


    <span style="color:#66d9ef">print</span>(i)
</code></pre></div><p>在粘贴到 Python shell 后，会收到以下提示：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#a6e22e">IndentationError</span>: expected an indented block
</code></pre></div><p>这是因为解释器认为空行表示 <code>for</code> 循环部分的结束。</p>
<p>IPython 有一个名为 <code>%paste</code> 的魔幻函数，可正确粘贴剪贴板的内容，包括空白。仅这一点，就是使用 IPython 的好理由。</p>
<h2 id="25模块">2.5　模块</h2>
<p>Python 默认情况下不会加载某些特征。这些特征包括语言本身的部分特征以及你自己下载的第三方包的特征。为了使用这些特征，你需要导入包含这些特征的模块。</p>
<p>一种方法是简单地导入模块本身：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> re
my_regex <span style="color:#f92672">=</span> re<span style="color:#f92672">.</span>compile(<span style="color:#e6db74">&#34;[0-9]+&#34;</span>, re<span style="color:#f92672">.</span>I)
</code></pre></div><p>在这里，<code>re</code> 是包含用于处理正则表达式的函数和常量的模块。通过 <code>import</code> 导入模块后，必须在这些函数前面加上 <code>re.</code> 才能访问它们。</p>
<p>如果代码中已有不同的 <code>re</code>，则可以使用别名：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> re <span style="color:#f92672">as</span> regex
my_regex <span style="color:#f92672">=</span> regex<span style="color:#f92672">.</span>compile(<span style="color:#e6db74">&#34;[0-9]+&#34;</span>, regex<span style="color:#f92672">.</span>I)
</code></pre></div><p>如果模块名称很长或者要打很多字，也可以这样做。例如，使用 matplotlib 可视化数据时，标准转换如下所示：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#f92672">as</span> plt

plt<span style="color:#f92672">.</span>plot(<span style="color:#f92672">...</span>)
</code></pre></div><p>如果你需要模块中的一些特定值，则可以显式导入它们并在没有权限限制的情况下使用它们：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> collections <span style="color:#f92672">import</span> defaultdict, Counter
lookup <span style="color:#f92672">=</span> defaultdict(int)
my_counter <span style="color:#f92672">=</span> Counter()
</code></pre></div><p>如果你是坏人，可以将模块的全部内容导入命名空间，这可能会无意中覆盖已定义的变量：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">match <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>
<span style="color:#f92672">from</span> re <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
<span style="color:#66d9ef">print</span>(match)
</code></pre></div><p>但是，只要你不是坏人，就别这么做。</p>
<h2 id="26函数">2.6　函数</h2>
<p>函数是一种通过输入零或其他数，返回相应输出的规则。在 Python 中，通常使用 <code>def</code> 定义函数：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">double</span>(x):
    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">    在这里，可以使用文档字符串来注释函数的用法。比如，这个函数就是将输入乘以2
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
    <span style="color:#66d9ef">return</span> x <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span>
</code></pre></div><p>Python 函数是<strong>第一类函数</strong>，这意味着可以将它们赋给别的变量，或将它们像其他参数一样传递给其他函数：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">apply_to_one</span>(f):
    <span style="color:#e6db74">&#34;&#34;&#34;调用函数f，并将1作为f的输入&#34;&#34;&#34;</span>
    <span style="color:#66d9ef">return</span> f(<span style="color:#ae81ff">1</span>)

my_double <span style="color:#f92672">=</span> double
x <span style="color:#f92672">=</span> apply_to_one(my_double)
</code></pre></div><p>创建简短的匿名函数或 <strong>lambda</strong> 也很容易：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">y <span style="color:#f92672">=</span> apply_to_one(<span style="color:#66d9ef">lambda</span> x: x <span style="color:#f92672">+</span> <span style="color:#ae81ff">4</span>)      <span style="color:#75715e"># 等于5</span>
</code></pre></div><p>可以将 lambda 赋给变量，尽管大多数人会告诉你应该用 <code>def</code>：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">another_double <span style="color:#f92672">=</span> <span style="color:#66d9ef">lambda</span> x: <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> x

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">another_double</span>(x):
    <span style="color:#e6db74">&#34;&#34;&#34;以此替代&#34;&#34;&#34;</span>
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> x
</code></pre></div><p>函数的参数可以定义默认值，使用非默认值时需要说明：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">my_print</span>(message <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;my default message&#34;</span>):
    <span style="color:#66d9ef">print</span>(message)

my_print(<span style="color:#e6db74">&#34;hello&#34;</span>)
my_print()
</code></pre></div><p>按名称指定参数有时很有用：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">full_name</span>(first <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;What&#39;s-his-name&#34;</span>, last <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Something&#34;</span>):
    <span style="color:#66d9ef">return</span> first <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; &#34;</span> <span style="color:#f92672">+</span> last

full_name(<span style="color:#e6db74">&#34;Joel&#34;</span>, <span style="color:#e6db74">&#34;Grus&#34;</span>)
full_name(<span style="color:#e6db74">&#34;Joel&#34;</span>)
full_name(last<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Grus&#34;</span>)
</code></pre></div><p>我们将创建很多很多函数。</p>
<h2 id="27字符串">2.7　字符串</h2>
<p>字符串可以用单引号或双引号分隔（但引号必须对应匹配）：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">single_quoted_string <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;data science&#39;</span>
double_quoted_string <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;data science&#34;</span>
</code></pre></div><p>Python 使用反斜杠为特殊字符编码。例如：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">tab_string <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">&#34;</span>
len(tab_string)
</code></pre></div><p>如果要将反斜杠作为反斜杠本身使用（可能在 Windows 系统中的目录名称或正则表达式中遇到），则可以使用 <code>r&quot;&quot;</code> 创建<strong>原始</strong>字符串：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">not_tab_string <span style="color:#f92672">=</span> <span style="color:#e6db74">r</span><span style="color:#e6db74">&#34;\t&#34;</span>
len(not_tab_string)
</code></pre></div><p>可以使用三重引号创建多行字符串：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">multi_line_string <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;&#34;这是第一行
</span><span style="color:#e6db74">这是第二行
</span><span style="color:#e6db74">这是第三行&#34;&#34;&#34;</span>
</code></pre></div><p><strong>f-string</strong> 是 Python 3.6 中的一个新的处理字符串方式，它提供了一种将值替换为字符串的简单方法。如果我们分别给出了名字和姓氏：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">first_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Joel&#34;</span>
last_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Grus&#34;</span>
</code></pre></div><p>要将它们组合成一个全名，有多种方法可以构造这样的 <code>fullname</code> 字符串：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">full_name1 <span style="color:#f92672">=</span> first_name <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; &#34;</span> <span style="color:#f92672">+</span> last_name               <span style="color:#75715e"># 字符串合并</span>
full_name2 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;{0} {1}&#34;</span><span style="color:#f92672">.</span>format(first_name, last_name)    <span style="color:#75715e"># string.format</span>
</code></pre></div><p>但 f-string 的方式更易于操作：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">full_name3 <span style="color:#f92672">=</span> f<span style="color:#e6db74">&#34;{first_name} {last_name}&#34;</span>
</code></pre></div><p>本书倾向于使用这种方法。</p>
<h2 id="28异常">2.8　异常</h2>
<p>当程序运行有问题时，Python 会报<strong>异常</strong>。未处理的异常会导致程序崩溃。可以使用 <code>try</code> 和 <code>except</code> 处理：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">try</span>:
    <span style="color:#66d9ef">print</span>(<span style="color:#ae81ff">0</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">0</span>)
<span style="color:#66d9ef">except</span> <span style="color:#a6e22e">ZeroDivisionError</span>:
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;cannot divide by zero&#34;</span>)
</code></pre></div><p>虽然在许多语言中异常被认为是不好的情况，但在 Python 中，不必因为使用这些技巧而感到难堪，有时这么做可以使代码更清晰。</p>
<h2 id="29列表">2.9　列表</h2>
<p>Python 中最基本的数据结构是<strong>列表</strong>，它是一个有序的集合（与其他语言中被称为<strong>数组</strong>的概念类似，但具有一些附加功能）：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">integer_list <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>]
heterogeneous_list <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;string&#34;</span>, <span style="color:#ae81ff">0.1</span>, True]
list_of_lists <span style="color:#f92672">=</span> [integer_list, heterogeneous_list, []]

list_length <span style="color:#f92672">=</span> len(integer_list)     <span style="color:#75715e"># 等于3</span>
list_sum    <span style="color:#f92672">=</span> sum(integer_list)     <span style="color:#75715e"># 等于6</span>
</code></pre></div><p>可以使用方括号获取或设置列表的第 n 个元素的值：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">x <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">9</span>]

zero <span style="color:#f92672">=</span> x[<span style="color:#ae81ff">0</span>]          <span style="color:#75715e"># 等于0，列表的索引是从0开始的</span>
one <span style="color:#f92672">=</span> x[<span style="color:#ae81ff">1</span>]           <span style="color:#75715e"># 等于1</span>
nine <span style="color:#f92672">=</span> x[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]         <span style="color:#75715e"># 等于9，表示列表最后一个元素的Python惯用法</span>
eight <span style="color:#f92672">=</span> x[<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]        <span style="color:#75715e"># 等于8，倒数第二个元素的Python惯用法</span>
x[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>            <span style="color:#75715e"># 现在x是[-1, 1, 2, 3, ..., 9]</span>
</code></pre></div><p>还可以使用方括号来对列表进行<strong>切片</strong>操作。切片 <code>i:j</code> 表示从 <code>i</code>（包括）到 <code>j</code>（不包括）的所有元素。如果在切片的开头留空，你将从列表的开头开始切片；如果末尾留空，你将切到列表的结尾：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">first_three <span style="color:#f92672">=</span> x[:<span style="color:#ae81ff">3</span>]                 <span style="color:#75715e"># [-1, 1, 2]</span>
three_to_end <span style="color:#f92672">=</span> x[<span style="color:#ae81ff">3</span>:]                <span style="color:#75715e"># [3, 4, ..., 9]</span>
one_to_four <span style="color:#f92672">=</span> x[<span style="color:#ae81ff">1</span>:<span style="color:#ae81ff">5</span>]                <span style="color:#75715e"># [1, 2, 3, 4]</span>
last_three <span style="color:#f92672">=</span> x[<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>:]                 <span style="color:#75715e"># [7, 8, 9]</span>
without_first_and_last <span style="color:#f92672">=</span> x[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]    <span style="color:#75715e"># [1, 2, ..., 8]</span>
copy_of_x <span style="color:#f92672">=</span> x[:]                    <span style="color:#75715e"># [-1, 1, 2, ..., 9]</span>
</code></pre></div><p>字符串和其他 “序列” 类型的数据可以用类似的方法切割。</p>
<p>切片可以通过第三个参数来表示其<strong>步幅</strong>，步幅可以是负数：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">every_third <span style="color:#f92672">=</span> x[::<span style="color:#ae81ff">3</span>]                <span style="color:#75715e"># [-1, 3, 6, 9]</span>
five_to_three <span style="color:#f92672">=</span> x[<span style="color:#ae81ff">5</span>:<span style="color:#ae81ff">2</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]           <span style="color:#75715e"># [5, 4, 3]</span>
</code></pre></div><p>Python 用运算符 <code>in</code> 来检查某值是否存在于列表中：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#ae81ff">1</span> <span style="color:#f92672">in</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>]
<span style="color:#ae81ff">0</span> <span style="color:#f92672">in</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>]
</code></pre></div><p>这种检查每次都会遍历整个列表的元素，这意味着除非列表长度很短（或者你不在乎检查需要多长时间），否则就不应该进行这样的检查。</p>
<p>将列表连接在一起很容易。如果要修改列表，可以使用 <code>extend</code> 从其他集合中添加元素：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">x <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>]
x<span style="color:#f92672">.</span>extend([<span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">6</span>])
</code></pre></div><p>如果你不想修改 <code>x</code>，可以使用列表加法：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">x <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>]
y <span style="color:#f92672">=</span> x <span style="color:#f92672">+</span> [<span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">6</span>]       <span style="color:#75715e"># y是[1, 2, 3, 4, 5, 6]；x没有变化</span>
</code></pre></div><p>更常见的做法是，一次在列表中只添加一个元素：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">x <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>]
x<span style="color:#f92672">.</span>append(<span style="color:#ae81ff">0</span>)
y <span style="color:#f92672">=</span> x[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]          <span style="color:#75715e"># 等于0</span>
z <span style="color:#f92672">=</span> len(x)         <span style="color:#75715e"># 等于4</span>
</code></pre></div><p>当你知道它们包含多少个元素时，可以方便地<strong>提取</strong>列表值：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">x, y <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>]
</code></pre></div><p>但当等号两边的元素个数不同时，就会报出 <code>ValueError</code>。</p>
<p>一种常见的习惯用法是使用下划线来表示要丢弃的值：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">_, y <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>]
</code></pre></div><h2 id="210元组">2.10　元组</h2>
<p>元组是列表的堂兄弟。对列表做的任何不涉及修改的操作都可以对元组进行。可以用圆括号（或什么都不用）而不是方括号来指定一个元组：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">my_list <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>]
my_tuple <span style="color:#f92672">=</span> (<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>)
other_tuple <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>
my_list[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>

<span style="color:#66d9ef">try</span><span style="color:#960050;background-color:#1e0010">：</span>
    my_tuple[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>
<span style="color:#66d9ef">except</span> <span style="color:#a6e22e">TypeError</span><span style="color:#960050;background-color:#1e0010">：</span>
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;cannot modify a tuple&#34;</span>)
</code></pre></div><p>元组是从函数返回多个值的便捷方式：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">sum_and_product</span>(x, y)<span style="color:#960050;background-color:#1e0010">：</span>
    <span style="color:#66d9ef">return</span> (x <span style="color:#f92672">+</span> y), (x <span style="color:#f92672">*</span> y)

sp <span style="color:#f92672">=</span> sum_and_product(<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>)
s, p <span style="color:#f92672">=</span> sum_and_product(<span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">10</span>)
</code></pre></div><p>元组（和列表）也可用于<strong>多重赋值</strong>（multiple assignment）：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">x, y <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>
x, y <span style="color:#f92672">=</span> y, x
</code></pre></div><h2 id="211字典">2.11　字典</h2>
<p>另一个基本数据结构是字典，它将<strong>值</strong>与<strong>键</strong>相关联，并允许快速检索给定键所对应的值：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">empty_dict <span style="color:#f92672">=</span> {}                   <span style="color:#75715e"># Python风格</span>
empty_dict2 <span style="color:#f92672">=</span> dict()              <span style="color:#75715e"># 不那么Python风格</span>
grades <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#34;Joel&#34;</span>: <span style="color:#ae81ff">80</span>, <span style="color:#e6db74">&#34;Tim&#34;</span>: <span style="color:#ae81ff">95</span>}  <span style="color:#75715e"># 字典字面量</span>
</code></pre></div><p>可以使用方括号查找键的值：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">joels_grade <span style="color:#f92672">=</span> grades[<span style="color:#e6db74">&#34;Joel&#34;</span>]      <span style="color:#75715e"># 等于80</span>
</code></pre></div><p>但是如果找的键不在字典中，则会报出 <code>KeyError</code>：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">try</span><span style="color:#960050;background-color:#1e0010">：</span>
    kates_grade <span style="color:#f92672">=</span> grades[<span style="color:#e6db74">&#34;Kate&#34;</span>]
<span style="color:#66d9ef">except</span> <span style="color:#a6e22e">KeyError</span><span style="color:#960050;background-color:#1e0010">：</span>
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;no grade for Kate!&#34;</span>)
</code></pre></div><p>可以用 <code>in</code> 确认键是否存在于字典中：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">joel_has_grade <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Joel&#34;</span> <span style="color:#f92672">in</span> grades     <span style="color:#75715e"># 存在（True）</span>
kate_has_grade <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Kate&#34;</span> <span style="color:#f92672">in</span> grades     <span style="color:#75715e"># 不存在（False）</span>
</code></pre></div><p>这种查找方式即使对于大型字典也很快。</p>
<p>字典有一个 <code>get</code> 方法，当查找一个不在字典中的键时，它返回一个默认值（而不是报出异常）：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">joels_grade <span style="color:#f92672">=</span> grades<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#34;Joel&#34;</span>, <span style="color:#ae81ff">0</span>)   <span style="color:#75715e"># 等于80</span>
kates_grade <span style="color:#f92672">=</span> grades<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#34;Kate&#34;</span>, <span style="color:#ae81ff">0</span>)   <span style="color:#75715e"># 等于0</span>
no_ones_grade <span style="color:#f92672">=</span> grades<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#34;No One&#34;</span>)  <span style="color:#75715e"># 默认值是None</span>
</code></pre></div><p>可以使用相同的方括号指定键 / 值对：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">grades[<span style="color:#e6db74">&#34;Tim&#34;</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">99</span>
grades[<span style="color:#e6db74">&#34;Kate&#34;</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span>
num_students <span style="color:#f92672">=</span> len(grades)
</code></pre></div><p>如第 1 章所述，可以使用字典来表示结构化数据：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">tweet <span style="color:#f92672">=</span> {
    <span style="color:#e6db74">&#34;user&#34;</span> : <span style="color:#e6db74">&#34;joelgrus&#34;</span>,
    <span style="color:#e6db74">&#34;text&#34;</span> : <span style="color:#e6db74">&#34;Data Science is Awesome&#34;</span>,
    <span style="color:#e6db74">&#34;retweet_count&#34;</span> : <span style="color:#ae81ff">100</span>,
    <span style="color:#e6db74">&#34;hashtags&#34;</span> : [<span style="color:#e6db74">&#34;#data&#34;</span>, <span style="color:#e6db74">&#34;#science&#34;</span>, <span style="color:#e6db74">&#34;#datascience&#34;</span>, <span style="color:#e6db74">&#34;#awesome&#34;</span>, <span style="color:#e6db74">&#34;#yolo&#34;</span>]
}
</code></pre></div><p>后面会有一个更棒的实现方式。</p>
<p>除了查特定的键，字典允许我们查里面所有的键与值：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">tweet_keys   <span style="color:#f92672">=</span> tweet<span style="color:#f92672">.</span>keys()
tweet_values <span style="color:#f92672">=</span> tweet<span style="color:#f92672">.</span>values()
tweet_items  <span style="color:#f92672">=</span> tweet<span style="color:#f92672">.</span>items()

<span style="color:#e6db74">&#34;user&#34;</span> <span style="color:#f92672">in</span> tweet_keys
<span style="color:#e6db74">&#34;user&#34;</span> <span style="color:#f92672">in</span> tweet
<span style="color:#e6db74">&#34;joelgrus&#34;</span> <span style="color:#f92672">in</span> tweet_values
</code></pre></div><p>字典键必须是 “可散列的”，尤其是不能使用列表作为键。如果你需要一个多维的键，则应该使用一个元组或找出一种方法将键转换成一个字符串。</p>
<h3 id="defaultdict"><code>defaultdict</code></h3>
<p>假设你需要计算某个文档中的单词数目。一种显而易见的方法是创建一个字典，其中键是单词，值是出现的次数。当检查每个单词时，如果它已在字典中，则增加其计数；如果不在字典中，则将其添加到字典中：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">word_counts <span style="color:#f92672">=</span> {}
<span style="color:#66d9ef">for</span> word <span style="color:#f92672">in</span> document:
    <span style="color:#66d9ef">if</span> word <span style="color:#f92672">in</span> word_counts:
        word_counts[word] <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
    <span style="color:#66d9ef">else</span>:
        word_counts[word] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</code></pre></div><p>也可以遵循 “与其瞻前顾后，不如果断行动” 的原则，在查找缺失键的时候，果断处理异常：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">word_counts <span style="color:#f92672">=</span> {}
<span style="color:#66d9ef">for</span> word <span style="color:#f92672">in</span> document:
    <span style="color:#66d9ef">try</span>:
        word_counts[word] <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
    <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">KeyError</span>:
        word_counts[word] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</code></pre></div><p>第三种方法是使用 <code>get</code>，它可以优雅地处理缺失键：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">word_counts <span style="color:#f92672">=</span> {}
<span style="color:#66d9ef">for</span> word <span style="color:#f92672">in</span> document:
    previous_count <span style="color:#f92672">=</span> word_counts<span style="color:#f92672">.</span>get(word, <span style="color:#ae81ff">0</span>)
    word_counts[word] <span style="color:#f92672">=</span> previous_count <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
</code></pre></div><p>上述三种方法都略显笨拙，这就是为什么 <code>defaultdict</code> 很有用。<code>defaultdict</code> 类似于标准的字典，除了当你尝试查找它不包含的键时，它首先使用你在创建它时提供的零参数函数为其添加值。为了使用 <code>defaultdict</code>，你必须从 <code>collections</code> 中导入它们：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> collections <span style="color:#f92672">import</span> defaultdict

word_counts <span style="color:#f92672">=</span> defaultdict(int)

<span style="color:#66d9ef">for</span> word <span style="color:#f92672">in</span> document:
    word_counts[word] <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</code></pre></div><p>该方法也可用于 <code>list</code> 或 <code>dict</code>，甚至是你自己的函数：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">dd_list <span style="color:#f92672">=</span> defaultdict(list)             <span style="color:#75715e"># list()生成一个空列表</span>
dd_list[<span style="color:#ae81ff">2</span>]<span style="color:#f92672">.</span>append(<span style="color:#ae81ff">1</span>)                    <span style="color:#75715e"># 现在dd_list包含{2: [1]}</span>

dd_dict <span style="color:#f92672">=</span> defaultdict(dict)             <span style="color:#75715e"># dict()生成一个空字典</span>
dd_dict[<span style="color:#e6db74">&#34;Joel&#34;</span>][<span style="color:#e6db74">&#34;City&#34;</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Seattle&#34;</span>     <span style="color:#75715e"># {&#34;Joel&#34; : {&#34;City&#34;: Seattle&#34;}}</span>

dd_pair <span style="color:#f92672">=</span> defaultdict(<span style="color:#66d9ef">lambda</span>: [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>])
dd_pair[<span style="color:#ae81ff">2</span>][<span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>                       <span style="color:#75715e"># 现在dd_pair包含{2: [0, 1]}</span>
</code></pre></div><p>当我们使用字典 “收集” 某些键的对应结果，并且不希望每次都检查键是否存在时，这是非常有用的方法。</p>
<h2 id="212计数器">2.12　计数器</h2>
<p>计数器将一个序列的值转换为类似于 <code>defaultdict(int)</code> 的键映射到计数的对象映射：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> collections <span style="color:#f92672">import</span> Counter
c <span style="color:#f92672">=</span> Counter([<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">0</span>])
</code></pre></div><p>这为我们解决单词计数问题提供了一种非常简单的方法：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">
word_counts <span style="color:#f92672">=</span> Counter(document)
</code></pre></div><p><code>Counter</code> 实例有通常很有用的 <code>most_common</code> 方法：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">
<span style="color:#66d9ef">for</span> word, count <span style="color:#f92672">in</span> word_counts<span style="color:#f92672">.</span>most_common(<span style="color:#ae81ff">10</span>):
    <span style="color:#66d9ef">print</span>(word, count)
</code></pre></div><h2 id="213集">2.13　集</h2>
<p>集是另一种很有用的数据结构，它表示一组<strong>不同</strong>元素的集合。可以在大括号中列出其元素来定义集合：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">primes_below_10 <span style="color:#f92672">=</span> {<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">7</span>}
</code></pre></div><p>但是，空集不能这样定义，因为 <code>{}</code> 已意味着 “空字典”。因此，需要使用 <code>set()</code> 定义空集：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">s <span style="color:#f92672">=</span> set()
s<span style="color:#f92672">.</span>add(<span style="color:#ae81ff">1</span>)       <span style="color:#75715e"># s现在是{1}</span>
s<span style="color:#f92672">.</span>add(<span style="color:#ae81ff">2</span>)       <span style="color:#75715e"># s现在是{1, 2}</span>
s<span style="color:#f92672">.</span>add(<span style="color:#ae81ff">2</span>)       <span style="color:#75715e"># s还是{1, 2}</span>
x <span style="color:#f92672">=</span> len(s)     <span style="color:#75715e"># 等于2</span>
y <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">in</span> s     <span style="color:#75715e"># 等于True</span>
z <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span> <span style="color:#f92672">in</span> s     <span style="color:#75715e"># 等于False</span>
</code></pre></div><p>我们使用集的主要原因有两个。一是集上有一种非常快速的操作：<code>in</code>。如果我们有大量项目，要对其元素进行测试，那么集比列表更合适：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">stopwords_list <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;a&#34;</span>, <span style="color:#e6db74">&#34;an&#34;</span>, <span style="color:#e6db74">&#34;at&#34;</span>] <span style="color:#f92672">+</span> hundreds_of_other_words <span style="color:#f92672">+</span> [<span style="color:#e6db74">&#34;yet&#34;</span>, <span style="color:#e6db74">&#34;you&#34;</span>]

<span style="color:#e6db74">&#34;zip&#34;</span> <span style="color:#f92672">in</span> stopwords_list

stopwords_set <span style="color:#f92672">=</span> set(stopwords_list)
<span style="color:#e6db74">&#34;zip&#34;</span> <span style="color:#f92672">in</span> stopwords_set
</code></pre></div><p>二是易于在汇总中找到<strong>离散</strong>的元素：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">item_list <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>]
num_items <span style="color:#f92672">=</span> len(item_list)                <span style="color:#75715e"># 6</span>
item_set <span style="color:#f92672">=</span> set(item_list)                 <span style="color:#75715e"># {1, 2, 3}</span>
num_distinct_items <span style="color:#f92672">=</span> len(item_set)        <span style="color:#75715e"># 3</span>
distinct_item_list <span style="color:#f92672">=</span> list(item_set)       <span style="color:#75715e"># [1, 2, 3]</span>
</code></pre></div><p>我们将使用集的频率远低于字典和列表。</p>
<h2 id="214控制流">2.14　控制流</h2>
<p>与大多数编程语言一样，可以使用 <code>if</code> 执行有条件的操作：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">if</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">2</span>:
    message <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;if only 1 were greater than two...&#34;</span>
<span style="color:#66d9ef">elif</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">3</span>:
    message <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;elif stands for &#39;else if&#39;&#34;</span>
<span style="color:#66d9ef">else</span>:
    message <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;when all else fails use else (if you want to)&#34;</span>
</code></pre></div><p>也可以在一行中写下 if-then-else <strong>三元组</strong>，我们偶尔会这样做：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">parity <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;even&#34;</span> <span style="color:#66d9ef">if</span> x <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">else</span> <span style="color:#e6db74">&#34;odd&#34;</span>
</code></pre></div><p>Python 也有 <code>while</code> 循环：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">x <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
<span style="color:#66d9ef">while</span> x <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">10</span>:
    <span style="color:#66d9ef">print</span>(f<span style="color:#e6db74">&#34;{x} is less than 10&#34;</span>)
    x <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</code></pre></div><p>但 <code>for</code> 和 <code>in</code> 是更常规的方式：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">
<span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">10</span>):
    <span style="color:#66d9ef">print</span>(f<span style="color:#e6db74">&#34;{x} is less than 10&#34;</span>)
</code></pre></div><p>如果你需要更复杂的逻辑表达式，可以使用 <code>continue</code> 和 <code>break</code>：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">10</span>):
    <span style="color:#66d9ef">if</span> x <span style="color:#f92672">==</span> <span style="color:#ae81ff">3</span><span style="color:#960050;background-color:#1e0010">：</span>
        <span style="color:#66d9ef">continue</span>
    <span style="color:#66d9ef">if</span> x <span style="color:#f92672">==</span> <span style="color:#ae81ff">5</span>:
        <span style="color:#66d9ef">break</span>
    <span style="color:#66d9ef">print</span>(x)
</code></pre></div><p>这段代码会打印 <code>0</code>、<code>1</code>、<code>2</code> 和 <code>4</code>。</p>
<h2 id="215真和假">2.15　真和假</h2>
<p>Python 中的布尔值除了首字母是大写的，其他用法与大多数其他语言一样：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">one_is_less_than_two <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">2</span>               <span style="color:#75715e"># 等于True</span>
true_equals_false <span style="color:#f92672">=</span> True <span style="color:#f92672">==</span> False          <span style="color:#75715e"># 等于False</span>
</code></pre></div><p>Python 使用 <code>None</code> 来表示不存在的值。它类似于其他语言的 <code>python</code>：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">x <span style="color:#f92672">=</span> None
<span style="color:#66d9ef">assert</span> x <span style="color:#f92672">==</span> None, <span style="color:#e6db74">&#34;这并非Python惯用的检查None的方式&#34;</span>
<span style="color:#66d9ef">assert</span> x <span style="color:#f92672">is</span> None, <span style="color:#e6db74">&#34;更符合Python惯用的检查None的方式&#34;</span>
</code></pre></div><p>Python 可使用任何可被认为是布尔值的表达。以下都表示 “假”：</p>
<ul>
<li><code>False</code></li>
<li><code>None</code></li>
<li><code>[]</code>（空列表）</li>
<li><code>{}</code>（空字典）</li>
<li><code>&quot;&quot;</code></li>
<li><code>set()</code></li>
<li><code>0</code></li>
<li><code>0.0</code></li>
</ul>
<p>基本上其他所有值被视为 “真”。这样你可以轻松使用 <code>if</code> 语句来对空列表、空字符串、空字典等进行检查。如果你不经意间做了这件事情，它有时也会导致棘手的 bug：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">s <span style="color:#f92672">=</span> some_function_that_returns_a_string()
<span style="color:#66d9ef">if</span> s:
    first_char <span style="color:#f92672">=</span> s[<span style="color:#ae81ff">0</span>]
<span style="color:#66d9ef">else</span>:
    first_char <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>
</code></pre></div><p>另一种较短（但可能更令人困惑）的做法如下所示：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">first_char <span style="color:#f92672">=</span> s <span style="color:#f92672">and</span> s[<span style="color:#ae81ff">0</span>]
</code></pre></div><p>当第一个值为 “真” 时返回第二个值，而当第一个值不为 “真” 时则返回第一个值。类似地，如果 <code>x</code> 的取值可能是一个数或可能是 <code>None</code>，那么</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">safe_x <span style="color:#f92672">=</span> x <span style="color:#f92672">or</span> <span style="color:#ae81ff">0</span>
</code></pre></div><p>绝对是一个数，然而：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">safe_x <span style="color:#f92672">=</span> x <span style="color:#66d9ef">if</span> x <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> None <span style="color:#66d9ef">else</span> <span style="color:#ae81ff">0</span>
</code></pre></div><p>可能更具可读性。</p>
<p>Python 有一个 <code>all</code> 函数，它的取值是列表，并在每个元素都是 “真” 的时候返回 <code>True</code>；还有一个 <code>any</code> 函数，当至少有一个元素是 “真” 时，它返回 <code>True</code>：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">all([True, <span style="color:#ae81ff">1</span>, {<span style="color:#ae81ff">3</span>} ])   <span style="color:#75715e"># True，每个元素都为&#34;真&#34;</span>
all([True, <span style="color:#ae81ff">1</span>, {}])     <span style="color:#75715e"># False，{}为&#34;假&#34;</span>
any([True, <span style="color:#ae81ff">1</span>, {}])     <span style="color:#75715e"># True，True为&#34;真&#34;的元素</span>
all([])                <span style="color:#75715e"># True，列表中无&#34;假&#34;的元素</span>
any([])                <span style="color:#75715e"># False，列表中无&#34;真&#34;的元素</span>
</code></pre></div><h2 id="216排序">2.16　排序</h2>
<p>每个 Python 列表都有一个 <code>sort</code> 方法可以对其排序。如果不想搞乱列表，则可以使用 <code>sorted</code> 函数，它会返回一个新列表：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">x <span style="color:#f92672">=</span> [<span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>]
y <span style="color:#f92672">=</span> sorted(x)     <span style="color:#75715e"># y是[1, 2, 3, 4]，x则没有变化</span>
x<span style="color:#f92672">.</span>sort()
</code></pre></div><p>默认情况下，<code>sort</code>（和 <code>sorted</code>）基于元素之间的朴素比较，将列表元素从小到大排序。</p>
<p>如果希望元素从大到小排序，则可以指定 <code>reverse=True</code> 参数。除了比较元素本身，还可以通过键来对函数的结果排序：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">
x <span style="color:#f92672">=</span> sorted([<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>], key<span style="color:#f92672">=</span>abs, reverse<span style="color:#f92672">=</span>True)


wc <span style="color:#f92672">=</span> sorted(word_counts<span style="color:#f92672">.</span>items(),
            key<span style="color:#f92672">=</span><span style="color:#66d9ef">lambda</span> word_and_count: word_and_count[<span style="color:#ae81ff">1</span>],
            reverse<span style="color:#f92672">=</span>True)
</code></pre></div><h2 id="217列表解析">2.17　列表解析</h2>
<p>有时，你可能希望在只保留列表的部分特定元素或更改其中一些元素，或同时做这两种变动的情况下，将列表转换为另一个列表。这样操作的 Python 技巧叫作<strong>列表解析</strong>（list comprehension）：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">even_numbers <span style="color:#f92672">=</span> [x <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">5</span>) <span style="color:#66d9ef">if</span> x <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>]      <span style="color:#75715e"># [0, 2, 4]</span>
squares      <span style="color:#f92672">=</span> [x <span style="color:#f92672">*</span> x <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">5</span>)]                <span style="color:#75715e"># [0, 1, 4, 9, 16]</span>
even_squares <span style="color:#f92672">=</span> [x <span style="color:#f92672">*</span> x <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> even_numbers]            <span style="color:#75715e"># [0, 4, 16]</span>
</code></pre></div><p>也可以类似地将列表转换为字典或集合：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">square_dict <span style="color:#f92672">=</span> {x: x <span style="color:#f92672">*</span> x <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">5</span>)}
square_set  <span style="color:#f92672">=</span> {x <span style="color:#f92672">*</span> x <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> [<span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]}
</code></pre></div><p>如果你不需要原列表中的值，则通常使用下划线作为变量：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">zeros <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span> <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> even_numbers]
</code></pre></div><p>列表解析可以包括多个 <code>for</code> 循环：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">pairs <span style="color:#f92672">=</span> [(x, y)
         <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">10</span>)
         <span style="color:#66d9ef">for</span> y <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">10</span>)]
</code></pre></div><p>后面的 <code>for</code> 语句可以使用前面 <code>for</code> 循环的结果：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">increasing_pairs <span style="color:#f92672">=</span> [(x, y)
                    <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">10</span>)
                    <span style="color:#66d9ef">for</span> y <span style="color:#f92672">in</span> range(x <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">10</span>)]
</code></pre></div><p>我们将大量使用列表解析。</p>
<h2 id="218自动化测试和断言">2.18　自动化测试和断言</h2>
<p>作为数据科学家，我们会编写大量代码。如何才能确信我们的代码是正确的呢？一种方法是使用<strong>类型</strong>（稍后讨论），另一种方法是<strong>自动化测试</strong>。</p>
<p>用于编写和运行测试的框架有很多，但在本书中，我们将限制自己使用 <code>assert</code> 语句，当指定的条件不是 “真” 时，就会导致代码报出 <code>AssertionError</code>：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">assert</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">2</span>
<span style="color:#66d9ef">assert</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#34;1 + 1 should equal 2 but didn&#39;t&#34;</span>
</code></pre></div><p>正如在第二种情况中所看到的，如果断言失败，你可以选择添加要打印的消息。</p>
<p>断言 1 + 1 = 2 并不是特别有趣。更有趣的是断言编写的函数正在按照预期计算：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">smallest_item</span>(xs):
    <span style="color:#66d9ef">return</span> min(xs)

<span style="color:#66d9ef">assert</span> smallest_item([<span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">40</span>]) <span style="color:#f92672">==</span> <span style="color:#ae81ff">5</span>
<span style="color:#66d9ef">assert</span> smallest_item([<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>]) <span style="color:#f92672">==</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
</code></pre></div><p>本书将以这种方式使用 <code>assert</code>。它是一个很好的实践，我们强烈建议你在自己的代码中随意使用它。（如果你看一下本书在 GitHub 上的代码，就会发现它包含了比书中印刷的多得多的 <code>assert</code> 语句。这有助于确保<strong>我们</strong>为你编写的代码完全正确。）</p>
<p>另一种不太常用的方式是断言函数的输入：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">smallest_item</span>(xs):
    <span style="color:#66d9ef">assert</span> xs, <span style="color:#e6db74">&#34;empty list has no smallest item&#34;</span>
    <span style="color:#66d9ef">return</span> min(xs)
</code></pre></div><p>我们偶尔会这样做，但更多时候会使用 <code>assert</code> 来检查代码是否正确。</p>
<h2 id="219面向对象编程">2.19　面向对象编程</h2>
<p>与许多语言一样，Python 允许定义<strong>类</strong>，以封装数据和函数，并对其进行操作。我们有时会用类来使代码更清晰、更简单。构建一个带有大量注释的示例来解释它们可能是最简单的。</p>
<p>我们将构建一个表示 “计数器” 的类，这个类用于在门口统计有多少人出现于 “数据科学高级主题” 会议中。</p>
<p>它有一个计数的结果，可以被单击以增加计数，允许 <code>read_count</code>，并可以重置为零。（在现实生活中，有一种计数器会从 9999 归零至 0000，但我们不会为此烦恼。）</p>
<p>要定义类，请使用关键字 <code>class</code> 和满足帕斯卡命名法（PascalCase）的名称：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CountingClicker</span>:
    <span style="color:#e6db74">&#34;&#34;&#34;一个类可以/应该像一个函数一样写文档字符串&#34;&#34;&#34;</span>
</code></pre></div><p>一个类包含零个或多个<strong>成员</strong>（member）函数。按照惯例，每个函数的第一个参数 <code>self</code> 引用特定的类实例。</p>
<p>通常，类有一个名为 <code>__init__</code> 的构造函数。它包括你构建类实例所需的所有参数，并执行你需要的所有初始设置：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__init</span> __(self, count <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>):
    self<span style="color:#f92672">.</span>count <span style="color:#f92672">=</span> count
</code></pre></div><p>虽然构造函数有一个有趣的名称，但我们只使用类名来构造计数器实例：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">clicker1 <span style="color:#f92672">=</span> CountingClicker()           <span style="color:#75715e"># 初始化为0</span>
clicker2 <span style="color:#f92672">=</span> CountingClicker(<span style="color:#ae81ff">100</span>)        <span style="color:#75715e"># 设置count = 100</span>
clicker3 <span style="color:#f92672">=</span> CountingClicker(count<span style="color:#f92672">=</span><span style="color:#ae81ff">100</span>)  <span style="color:#75715e"># 与上面效果相同但更明确的表达方式</span>
</code></pre></div><p>请注意，<code>__init__</code> 方法名称以双下划线开头和结尾。这些 “神奇” 方法有时被称为 “dunder” 方法（即 <code>doubleUNDERscore</code> 的简写）并代表 “特殊” 行为。</p>
<blockquote>
<p>名称以下划线开头的类方法 —— 按惯例 —— 可以认为是 “私有” 的，且类的用户不应该直接调用它们。但是，Python 不会阻止用户直接调用它们。</p>
</blockquote>
<p>另一个类似的方法是 <code>__repr__</code>，它生成类实例中的字符串表示：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> __repr__(self):
    <span style="color:#66d9ef">return</span> f<span style="color:#e6db74">&#34;CountingClicker(count={self.count})&#34;</span>
</code></pre></div><p>最后需要实现类的<strong>公共</strong>（public）API：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">click</span>(self, num_times <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>):
    <span style="color:#e6db74">&#34;&#34;&#34;点击计时器若干次&#34;&#34;&#34;</span>
    self<span style="color:#f92672">.</span>count <span style="color:#f92672">+=</span> num_times

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">read</span>(self):
    <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>count

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">reset</span>(self):
    self<span style="color:#f92672">.</span>count <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</code></pre></div><p>完成类的定义后，用 <code>assert</code> 为我们的计数器编写一些测试用例：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">clicker <span style="color:#f92672">=</span> CountingClicker()
<span style="color:#66d9ef">assert</span> clicker<span style="color:#f92672">.</span>read() <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74">&#34;clicker should start with count 0&#34;</span>
clicker<span style="color:#f92672">.</span>click()
clicker<span style="color:#f92672">.</span>click()
<span style="color:#66d9ef">assert</span> clicker<span style="color:#f92672">.</span>read() <span style="color:#f92672">==</span> <span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#34;after two clicks, clicker should have count 2&#34;</span>
clicker<span style="color:#f92672">.</span>reset()
<span style="color:#66d9ef">assert</span> clicker<span style="color:#f92672">.</span>read() <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74">&#34;after reset, clicker should be back to 0&#34;</span>
</code></pre></div><p>编写这样的测试用例有助于确保代码按其设计的方式工作，并且当我们对其进行更改后它仍会正常工作。</p>
<p>我们偶尔也会创建从父类<strong>继承</strong>（inherit）其某些功能的<strong>子类</strong>（subclass）。例如，可以使用 <code>Counting Clicker</code> 作为基类创建一个不可重置的点击器，并重写 <code>reset</code> 方法，使其不执行任何操作：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">NoResetClicker</span>(CountingClicker):



    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">reset</span>(self):
        <span style="color:#66d9ef">pass</span>

clicker2 <span style="color:#f92672">=</span> NoResetClicker()
<span style="color:#66d9ef">assert</span> clicker2<span style="color:#f92672">.</span>read() <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>
clicker2<span style="color:#f92672">.</span>click()
<span style="color:#66d9ef">assert</span> clicker2<span style="color:#f92672">.</span>read() <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>
clicker2<span style="color:#f92672">.</span>reset()
<span style="color:#66d9ef">assert</span> clicker2<span style="color:#f92672">.</span>read() <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#34;reset shouldn&#39;t do anything&#34;</span>
</code></pre></div><h2 id="220迭代器和生成器">2.20　迭代器和生成器</h2>
<p>列表的一个好处是可以通过索引检索特定元素，但你并不总是需要这个功能！十亿个数的列表会占用大量内存。如果你一次只想要一个元素，那么没必要让它们占满内存。如果你只需要前几个元素，那么产生全部的十亿个数就很浪费。</p>
<p>通常只需使用 <code>for</code> 和 <code>in</code> 迭代数据集即可。在这种情况下，我们可以创建<strong>生成器</strong>（generator），它可以像列表一样迭代，但根据需要延迟（lazily）生成它们的值。</p>
<p>创建生成器的一种方法是使用函数和 <code>yield</code> 运算符：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">generate_range</span>(n):
    i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    <span style="color:#66d9ef">while</span> i <span style="color:#f92672">&lt;</span> n:
        <span style="color:#66d9ef">yield</span> i
        i <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</code></pre></div><p>下面的循环每次消耗一个 <code>yield</code> 值，直到消耗完：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> generate_range(<span style="color:#ae81ff">10</span>):
    <span style="color:#66d9ef">print</span>(f<span style="color:#e6db74">&#34;i: {i}&#34;</span>)
</code></pre></div><p>（事实上，<code>range</code> 函数本身就是延迟的，因此这样做没什么意义。）</p>
<p>使用生成器，你甚至可以创建一个无限序列：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">natural_numbers</span>():
    <span style="color:#e6db74">&#34;&#34;&#34;返回1, 2, 3, ...&#34;&#34;&#34;</span>
    n <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
    <span style="color:#66d9ef">while</span> True:
        <span style="color:#66d9ef">yield</span> n
        n <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</code></pre></div><p>尽管你可能不应该在没有使用某种 <code>break</code> 逻辑的情况下进行这种迭代。</p>
<blockquote>
<p>延迟的另一面是你只能对生成器迭代一次。如果需要多次迭代，则需要每次重新创建生成器，或使用列表。如果生成值的消耗很高，则使用列表或许更好。</p>
</blockquote>
<p>创建生成器的第二种方法是使用包含在圆括号中的 <code>for</code> 语句解析：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">evens_below_20 <span style="color:#f92672">=</span> (i <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> generate_range(<span style="color:#ae81ff">20</span>) <span style="color:#66d9ef">if</span> i <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>)
</code></pre></div><p>这种 “生成器解析” 在你（使用 <code>for</code> 或 <code>next</code>）迭代它之前不做任何工作。可以使用它来构建精细的数据处理管道：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">
data <span style="color:#f92672">=</span> natural_numbers()
evens <span style="color:#f92672">=</span> (x <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> data <span style="color:#66d9ef">if</span> x <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>)
even_squares <span style="color:#f92672">=</span> (x <span style="color:#f92672">**</span> <span style="color:#ae81ff">2</span> <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> evens)
even_squares_ending_in_six <span style="color:#f92672">=</span> (x <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> even_squares <span style="color:#66d9ef">if</span> x <span style="color:#f92672">%</span> <span style="color:#ae81ff">10</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">6</span>)
</code></pre></div><p>通常，当我们迭代列表或生成器时，不仅需要值，还需要它们的索引。对于这种常见情况，Python 提供了一个 <code>enumerate</code> 函数，它将值转换为 <code>(index, value)</code> 对：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">names <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;Alice&#34;</span>, <span style="color:#e6db74">&#34;Bob&#34;</span>, <span style="color:#e6db74">&#34;Charlie&#34;</span>, <span style="color:#e6db74">&#34;Debbie&#34;</span>]


<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(names)):
    <span style="color:#66d9ef">print</span>(f<span style="color:#e6db74">&#34;name {i} is {names[i]}&#34;</span>)


i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
<span style="color:#66d9ef">for</span> name <span style="color:#f92672">in</span> names:
    <span style="color:#66d9ef">print</span>(f<span style="color:#e6db74">&#34;name {i} is {names[i]}&#34;</span>)
    i <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>


<span style="color:#66d9ef">for</span> i, name <span style="color:#f92672">in</span> enumerate(names):
    <span style="color:#66d9ef">print</span>(f<span style="color:#e6db74">&#34;name {i} is {name}&#34;</span>)
</code></pre></div><p>我们会经常使用这种技巧。</p>
<h2 id="221随机性">2.21　随机性</h2>
<p>当我们学习数据科学时，经常需要生成随机数。可以使用 <code>random</code> 模块生成随机数：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> random
random<span style="color:#f92672">.</span>seed(<span style="color:#ae81ff">10</span>)

four_uniform_randoms <span style="color:#f92672">=</span> [random<span style="color:#f92672">.</span>random() <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">4</span>)]
</code></pre></div><p>如果你想获得可重现的结果，<code>random</code> 可以根据 <code>random.seed</code> 设置的内部状态生成<strong>伪随机</strong>（即确定性）数：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">random<span style="color:#f92672">.</span>seed(<span style="color:#ae81ff">10</span>)
<span style="color:#66d9ef">print</span>(random<span style="color:#f92672">.</span>random())
random<span style="color:#f92672">.</span>seed(<span style="color:#ae81ff">10</span>)
<span style="color:#66d9ef">print</span>(random<span style="color:#f92672">.</span>random())
</code></pre></div><p>我们有时会使用 <code>random.randrange</code>，它接受一个或两个参数，并返回从相应 <code>range</code> 中随机选择的一个元素：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">random<span style="color:#f92672">.</span>randrange(<span style="color:#ae81ff">10</span>)
random<span style="color:#f92672">.</span>randrange(<span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">6</span>)
</code></pre></div><p>还有一些其他的方便方法。例如，<code>random.shuffle</code> 可以随机重新排序列表中的元素：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">up_to_ten <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">9</span>, <span style="color:#ae81ff">10</span>]
random<span style="color:#f92672">.</span>shuffle(up_to_ten)
<span style="color:#66d9ef">print</span>(up_to_ten)
</code></pre></div><p>如果你需要从列表中随机取一个元素，则可以使用 <code>random.choice</code>：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">my_best_friend <span style="color:#f92672">=</span> random<span style="color:#f92672">.</span>choice([<span style="color:#e6db74">&#34;Alice&#34;</span>, <span style="color:#e6db74">&#34;Bob&#34;</span>, <span style="color:#e6db74">&#34;Charlie&#34;</span>])     <span style="color:#75715e"># 我得到的是&#34;Bob&#34;</span>
</code></pre></div><p>如果需要不放回地随机选择元素样本（即没有重复），则可以使用 <code>random.sample</code>：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">lottery_numbers <span style="color:#f92672">=</span> range(<span style="color:#ae81ff">60</span>)
winning_numbers <span style="color:#f92672">=</span> random<span style="color:#f92672">.</span>sample(lottery_numbers, <span style="color:#ae81ff">6</span>)  <span style="color:#75715e"># [16, 36, 10, 6, 25, 9]</span>
</code></pre></div><p>如果需要放回地随机选择元素样本（即允许重复），则可以多次调用 <code>random.choice</code>：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">four_with_replacement <span style="color:#f92672">=</span> [random<span style="color:#f92672">.</span>choice(range(<span style="color:#ae81ff">10</span>)) <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">4</span>)]
<span style="color:#66d9ef">print</span>(four_with_replacement)
</code></pre></div><h2 id="222正则表达式">2.22　正则表达式</h2>
<p>正则表达式提供了一种搜索文本的方法。它们非常有用，但也相当复杂 —— 因此有很多专门介绍正则表达式的书。在后面涉及正则表达式的地方，我们会详细讲解，这里只给出在 Python 中如何使用它们的几个示例：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> re

re_examples <span style="color:#f92672">=</span> [
    <span style="color:#f92672">not</span> re<span style="color:#f92672">.</span>match(<span style="color:#e6db74">&#34;a&#34;</span>, <span style="color:#e6db74">&#34;cat&#34;</span>),
    re<span style="color:#f92672">.</span>search(<span style="color:#e6db74">&#34;a&#34;</span>, <span style="color:#e6db74">&#34;cat&#34;</span>),
    <span style="color:#f92672">not</span> re<span style="color:#f92672">.</span>search(<span style="color:#e6db74">&#34;c&#34;</span>, <span style="color:#e6db74">&#34;dog&#34;</span>),
    <span style="color:#ae81ff">3</span> <span style="color:#f92672">==</span> len(re<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#34;[ab]&#34;</span>, <span style="color:#e6db74">&#34;carbs&#34;</span>)),

    <span style="color:#e6db74">&#34;R-D-&#34;</span> <span style="color:#f92672">==</span> re<span style="color:#f92672">.</span>sub(<span style="color:#e6db74">&#34;[0-9]&#34;</span>, <span style="color:#e6db74">&#34;-&#34;</span>, <span style="color:#e6db74">&#34;R2D2&#34;</span>)
    ]

<span style="color:#66d9ef">assert</span> all(re_examples), <span style="color:#e6db74">&#34;all the regex examples should be True&#34;</span>
</code></pre></div><p>一件需要注意的重要事情是 <code>re.match</code> 检查字符串的<strong>开头</strong>是否与正则表达式匹配，而 <code>re.search</code> 检查字符串的<strong>任何部分</strong>是否与正则表达式匹配。在某些时候如果不能区分这两个功能，就会造成不好的结果。</p>
<p>官方文档中有更详细的说明。</p>
<h2 id="223函数式编程">2.23　函数式编程</h2>
<blockquote>
<p>本书的第 1 版在此板块介绍了 Python 的 <code>partial</code>、<code>map</code>、<code>reduce</code> 和 <code>filter</code> 函数。在启蒙之旅中，我意识到最好避开使用这些函数。本书已用列表解析、<code>for</code> 循环和其他更符合 Python 风格的结构取代了它们。</p>
</blockquote>
<h2 id="224压缩和参数拆分">2.24　压缩和参数拆分</h2>
<p>当需要将两个或多个列表<strong>压缩</strong>（zip）在一起时，使用 <code>zip</code> 函数可以将多个可迭代对象转换为一个以对应函数元组为元素的可迭代对象：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">list1 <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;a&#39;</span>, <span style="color:#e6db74">&#39;b&#39;</span>, <span style="color:#e6db74">&#39;c&#39;</span>]
list2 <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>]


[pair <span style="color:#66d9ef">for</span> pair <span style="color:#f92672">in</span> zip(list1, list2)]
</code></pre></div><p>如果列表的长度不同，则 <code>zip</code> 会在第一个列表结束后立即停止。</p>
<p>你还可以使用一种特殊的技巧 “解压” 列表：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">pairs <span style="color:#f92672">=</span> [(<span style="color:#e6db74">&#39;a&#39;</span>, <span style="color:#ae81ff">1</span>), (<span style="color:#e6db74">&#39;b&#39;</span>, <span style="color:#ae81ff">2</span>), (<span style="color:#e6db74">&#39;c&#39;</span>, <span style="color:#ae81ff">3</span>)]
letters, numbers <span style="color:#f92672">=</span> zip(<span style="color:#f92672">*</span>pairs)
</code></pre></div><p>星号（<code>*</code>）执行<strong>参数拆分</strong>（argument unpacking），它使用 <code>pairs</code> 作为独立参数传给 <code>zip</code>。结果和调用下面的函数一样：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">letters, numbers <span style="color:#f92672">=</span> zip((<span style="color:#e6db74">&#39;a&#39;</span>, <span style="color:#ae81ff">1</span>), (<span style="color:#e6db74">&#39;b&#39;</span>, <span style="color:#ae81ff">2</span>), (<span style="color:#e6db74">&#39;c&#39;</span>, <span style="color:#ae81ff">3</span>))
</code></pre></div><p>可以将参数拆分与任何函数一起使用：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">add</span>(a, b): <span style="color:#66d9ef">return</span> a <span style="color:#f92672">+</span> b

add(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>)
<span style="color:#66d9ef">try</span>:
    add([<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>])
<span style="color:#66d9ef">except</span> <span style="color:#a6e22e">TypeError</span>:
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;add expects two inputs&#34;</span>)
add(<span style="color:#f92672">*</span>[<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>])
</code></pre></div><p>参数拆分并不是特别常用，但当我们用到它时，就会发现这是一个巧妙的技巧。</p>
<h2 id="225args-和-kwargs">2.25　<code>args</code> 和 <code>kwargs</code></h2>
<p>假设我们想要创建一个高阶函数，它将某个函数 <code>f</code> 作为输入，对于任何输入，都返回 <code>f</code> 值的两倍的新函数：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">doubler</span>(f):

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">g</span>(x):
        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> f(x)

    <span style="color:#66d9ef">return</span> g
</code></pre></div><p>这个函数在下面的情况中可以实现：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">f1</span>(x):
    <span style="color:#66d9ef">return</span> x <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>

g <span style="color:#f92672">=</span> doubler(f1)
<span style="color:#66d9ef">assert</span> g(<span style="color:#ae81ff">3</span>) <span style="color:#f92672">==</span> <span style="color:#ae81ff">8</span>,  <span style="color:#e6db74">&#34;(3 + 1) * 2 should equal 8&#34;</span>
<span style="color:#66d9ef">assert</span> g(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74">&#34;(-1 + 1) * 2 should equal 0&#34;</span>
</code></pre></div><p>但是，它不适用于带有多个参数的函数：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">f2</span>(x, y):
    <span style="color:#66d9ef">return</span> x <span style="color:#f92672">+</span> y

g <span style="color:#f92672">=</span> doubler(f2)
<span style="color:#66d9ef">try</span>:
    g(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>)
<span style="color:#66d9ef">except</span> <span style="color:#a6e22e">TypeError</span>:
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;as defined, g only takes one argument&#34;</span>)
</code></pre></div><p>我们需要的是一种指定可以采用任意参数的函数的方法。可以通过参数拆分和一些小技巧来做到这一点：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">magic</span>(<span style="color:#f92672">*</span>args, <span style="color:#f92672">**</span>kwargs):
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;unnamed args:&#34;</span>, args)
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;keyword args:&#34;</span>, kwargs)

magic(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, key<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;word&#34;</span>, key2<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;word2&#34;</span>)
</code></pre></div><p>也就是说，当我们定义这样的函数时，<code>args</code> 是其未命名参数的元组，而 <code>kwargs</code> 是其已命名参数的字典。反过来，则可以使用列表（或元组）和字典为函数<strong>提供</strong>参数：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">other_way_magic</span>(x, y, z):
    <span style="color:#66d9ef">return</span> x <span style="color:#f92672">+</span> y <span style="color:#f92672">+</span> z

x_y_list <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>]
z_dict <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#34;z&#34;</span>: <span style="color:#ae81ff">3</span>}
<span style="color:#66d9ef">assert</span> other_way_magic(<span style="color:#f92672">*</span>x_y_list, <span style="color:#f92672">**</span>z_dict) <span style="color:#f92672">==</span> <span style="color:#ae81ff">6</span>, <span style="color:#e6db74">&#34;1 + 2 + 3 should be 6&#34;</span>
</code></pre></div><p>你可以用类似的方式，使用这种有趣的技巧。我们只会用它来创建可以接受任意参数的高阶函数：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">doubler_correct</span>(f):
    <span style="color:#e6db74">&#34;&#34;&#34;无论f需要的输入是什么，这个函数都能正常工作&#34;&#34;&#34;</span>
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">g</span>(<span style="color:#f92672">*</span>args, <span style="color:#f92672">**</span>kwargs):
        <span style="color:#e6db74">&#34;&#34;&#34;无论g收到了什么输入，都将它们传给f&#34;&#34;&#34;</span>
        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> f(<span style="color:#f92672">*</span>args, <span style="color:#f92672">**</span>kwargs)
    <span style="color:#66d9ef">return</span> g

g <span style="color:#f92672">=</span> doubler_correct(f2)
<span style="color:#66d9ef">assert</span> g(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>) <span style="color:#f92672">==</span> <span style="color:#ae81ff">6</span>, <span style="color:#e6db74">&#34;doubler should work now&#34;</span>
</code></pre></div><p>一般来说，如果你明确知道函数需要什么类型的参数，那么你的代码会更加正确且更具可读性。因此，只有当我们没有其他选择时，才会使用 <code>args</code> 和 <code>kwargs</code>。</p>
<h2 id="226类型注释">2.26　类型注释</h2>
<p>Python 是一种<strong>动态类型</strong>（dynamically typed）语言。这意味着，只要我们以有效的方式使用对象，Python 通常不关心对象类型：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">add</span>(a, b):
    <span style="color:#66d9ef">return</span> a <span style="color:#f92672">+</span> b

<span style="color:#66d9ef">assert</span> add(<span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">5</span>) <span style="color:#f92672">==</span> <span style="color:#ae81ff">15</span>,                    <span style="color:#e6db74">&#34;+ is valid for numbers&#34;</span>
<span style="color:#66d9ef">assert</span> add([<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>], [<span style="color:#ae81ff">3</span>]) <span style="color:#f92672">==</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>],       <span style="color:#e6db74">&#34;+ is valid for lists&#34;</span>
<span style="color:#66d9ef">assert</span> add(<span style="color:#e6db74">&#34;hi &#34;</span>, <span style="color:#e6db74">&#34;there&#34;</span>) <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;hi there&#34;</span>,   <span style="color:#e6db74">&#34;+ is valid for strings&#34;</span>

<span style="color:#66d9ef">try</span>:
    add(<span style="color:#ae81ff">10</span>, <span style="color:#e6db74">&#34;five&#34;</span>)
<span style="color:#66d9ef">except</span> <span style="color:#a6e22e">TypeError</span>:
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;cannot add an int to a string&#34;</span>)
</code></pre></div><p>而在<strong>静态类型</strong>（statically typed）语言中，我们的函数和对象将需要指定的类型：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">add</span>(a: int, b: int) <span style="color:#f92672">-&gt;</span> int:
    <span style="color:#66d9ef">return</span> a <span style="color:#f92672">+</span> b

add(<span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">5</span>)
add(<span style="color:#e6db74">&#34;hi &#34;</span>, <span style="color:#e6db74">&#34;there&#34;</span>)
</code></pre></div><p>实际上，Python 的近几个版本（差不多）具备这样的功能。前一版带有 <code>int</code> 类型注释的 <code>add</code> 函数就是有效的 Python 3.6 写法！</p>
<p>但是，这些类型注释实际上并没有<strong>做</strong>什么贡献。你仍可以使用带注释的 <code>add</code> 函数来添加字符串，并且对 <code>add(10, &quot;five&quot;)</code> 的调用仍会引发完全相同的 <code>TypeError</code>。</p>
<p>也就是说，在 Python 代码中使用类型注释仍（至少）有四个不错的理由：</p>
<ul>
<li>
<p>类型是一种重要的文档形式。在一本通过代码教你理论和数学概念的书中，这是非常正确的。比较以下两个函数存根：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">dot_product</span>(x, y): <span style="color:#f92672">...</span>


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">dot_product</span>(x: Vector, y: Vector) <span style="color:#f92672">-&gt;</span> float: <span style="color:#f92672">...</span>
</code></pre></div><p>第二个信息丰富得多，因此希望你也这样做。（此时我已习惯于输入提示，而很难阅读无类型注释的 Python 代码。）</p>
</li>
<li>
<p>有一些外部工具（最受欢迎的是 <code>mypy</code>）来读取代码，检查类型注释，并<strong>在运行代码之前</strong>提示类型错误。例如，如果你在包含 <code>add(&quot;hi &quot;, &quot;there&quot;)</code> 的文件上运行 <code>mypy</code>，它就会警告你：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">error: Argument <span style="color:#ae81ff">1</span> to <span style="color:#e6db74">&#34;add&#34;</span> has incompatible type <span style="color:#e6db74">&#34;str&#34;</span>; expected <span style="color:#e6db74">&#34;int&#34;</span>
</code></pre></div><p>与 <code>assert</code> 测试一样，这是在你运行代码之前查找代码错误的好方法。书中的叙述不涉及这种类型检查，但在这之前我会运行一段这样的程序，以确保<strong>书本身的正确性</strong>。</p>
</li>
<li>
<p>考虑代码中的类型，迫使你设计更清晰的函数和接口：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> typing <span style="color:#f92672">import</span> Union

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">secretly_ugly_function</span>(value, operation): <span style="color:#f92672">...</span>

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">ugly_function</span>(value: int,
                  operation: Union[str, int, float, bool]) <span style="color:#f92672">-&gt;</span> int:
</code></pre></div><p>在这里的函数中，其 <code>operation</code> 参数可以是 <code>string</code>、<code>int</code>、<code>float</code> 或 <code>bool</code>。这个功能很可能很脆弱且难以使用，但类型被指明后，它变得更加清晰。这迫使我们以不那么笨重的方式来设计，用户因此会非常感谢我们。</p>
</li>
<li>
<p>注明类型后，编辑器能帮助你实现自动补全函数（见图 2-1）等操作，并对类型错误有所反馈。</p>
</li>
</ul>
<p>有些人坚持认为，类型提示对大型项目可能有价值，对小型项目却不划算。然而，由于类型提示几乎无须花费额外的时间去输入，同时编辑器的提示能节省时间，因此，我认为即使对于小型项目，类型提示实际上也有助于更快地编写代码。</p>
<p>出于这些原因，本书余下的所有代码都将使用类型注释。希望通过使用类型注释来推动读者保持这样的习惯。但我怀疑在读完本书后读者会改变主意。</p>
<h3 id="如何编写类型注释">如何编写类型注释</h3>
<p>可以看到，对于 <code>int</code>、<code>bool</code> 以及 <code>float</code> 这样的内置类型，只需使用类型本身作为注释即可。但如果你有一个列表该怎么办呢？</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">total</span>(xs: list) <span style="color:#f92672">-&gt;</span> float:
    <span style="color:#66d9ef">return</span> sum(total)
</code></pre></div><p>这样做是正确的，但类型不够具体。我们真的希望 <code>xs</code> 是一个以浮点数为元素的列表，而不是（比如说）一个以字符串为元素的列表。</p>
<p><code>typing</code> 模块提供了许多参数化类型，我们可以用它来做到这一点：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> typing <span style="color:#f92672">import</span> List

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">total</span>(xs: List[float]) <span style="color:#f92672">-&gt;</span> float:
    <span style="color:#66d9ef">return</span> sum(total)
</code></pre></div><p>目前，我们只为函数的参数和返回值指定了类型注释。对于变量，常用类型如下所示：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># 下面是在定义变量时指定类型的方法</span>
<span style="color:#75715e"># 但这也并不是必需的，很明显x是int类型</span>
x: int <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>
</code></pre></div><p>但是，有时它并不明显：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">values <span style="color:#f92672">=</span> []         <span style="color:#75715e"># 这是什么类型</span>
best_so_far <span style="color:#f92672">=</span> None  <span style="color:#75715e"># 这又是什么类型</span>
</code></pre></div><p>在这种情况下，我们将提供内联类型提示：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> typing <span style="color:#f92672">import</span> Optional

values: List[int] <span style="color:#f92672">=</span> []
best_so_far: Optional[float] <span style="color:#f92672">=</span> None  <span style="color:#75715e"># 既可以是float又可以是None</span>
</code></pre></div><p><code>typing</code> 模块包含许多其他类型，我们只使用其中的一部分：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># 下面的类型注释都不是必需的</span>
<span style="color:#f92672">from</span> typing <span style="color:#f92672">import</span> Dict, Iterable, Tuple

<span style="color:#75715e"># 键是string类型，值是int类型</span>
counts: Dict[str, int] <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;data&#39;</span>: <span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#39;science&#39;</span>: <span style="color:#ae81ff">2</span>}

<span style="color:#75715e"># 列表与生成器都可迭代</span>
<span style="color:#66d9ef">if</span> lazy:
    evens: Iterable[int] <span style="color:#f92672">=</span> (x <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">10</span>) <span style="color:#66d9ef">if</span> x <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>)
<span style="color:#66d9ef">else</span>:
    evens <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">8</span>]

<span style="color:#75715e"># 元组指定每个元素的类型</span>
triple: Tuple[int, float, int] <span style="color:#f92672">=</span> (<span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">2.3</span>, <span style="color:#ae81ff">5</span>)
</code></pre></div><p>最后，由于 Python 有一级函数，因此它们还需要一种类型来表示。下面是一个精心设计的例子：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> typing <span style="color:#f92672">import</span> Callable



<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">twice</span>(repeater: Callable[[str, int], str], s: str) <span style="color:#f92672">-&gt;</span> str:
    <span style="color:#66d9ef">return</span> repeater(s, <span style="color:#ae81ff">2</span>)

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">comma_repeater</span>(s: str, n: int) <span style="color:#f92672">-&gt;</span> str:
    n_copies <span style="color:#f92672">=</span> [s <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(n)]
    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;, &#39;</span><span style="color:#f92672">.</span>join(n_copies)

<span style="color:#66d9ef">assert</span> twice(comma_repeater, <span style="color:#e6db74">&#34;type hints&#34;</span>) <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;type hints, type hints&#34;</span>
</code></pre></div><p>因为类型注释只是 Python 对象，所以我们将它们分配给变量以使其更容易引用：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">Number <span style="color:#f92672">=</span> int
Numbers <span style="color:#f92672">=</span> List[Number]

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">total</span>(xs<span style="color:#960050;background-color:#1e0010">：</span>Numbers) <span style="color:#f92672">-&gt;</span> Number:
    <span style="color:#66d9ef">return</span> sum(xs)
</code></pre></div><p>读完本书后，你会非常熟悉读写类型注释，我们希望你能在自己的代码中使用它们。</p>
<h2 id="227欢迎来到-datasciencester">2.27　欢迎来到 DataSciencester</h2>
<p>这些就是新员工培训的全部内容。对了，还有不要挪用东西。</p>
<h2 id="228进一步探索">2.28　进一步探索</h2>
<ul>
<li>Python 教程比比皆是，官方教程是一个不错的选择。</li>
<li>如果你决定使用 IPython，官方 IPython 教程将帮你入门，试试吧。</li>
<li><code>mypy</code> 文档将为你提供关于 Python 类型注释和类型检查的更多信息。</li>
</ul>
		</div>
		<footer class="post__footer">
			
<div class="post__tags tags clearfix">
	<svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5 0 11V3C0 1.5.8.8.8.8S1.5 0 3 0h8c1.5 0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/></svg>
	<ul class="tags__list">
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/python/" rel="tag">Python</a>
		</li>
	</ul>
</div>
		</footer>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/2021/01/how-to-install-jupyter-notebook-in-your-server/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">如何在服務器上凑一個 Jupyter Notebook</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/2021/01/disscuss-the-elegance-of-the-program/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">小議程序的優雅</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2021 by Miao with Love..
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
	</div>
<script async defer src="/js/menu.js"></script>
<script src="/js/custom.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script>
</body>
</html>